# second entity, links, link methods, init, procedures, local variables,
# dump's suffix argument, choice

import:
   - ../standard/console.yml
   - generations/generation.yml
   #Â dependance
   - dependance/deces_dependance.yml
   - dependance/dependance_transition.yml

entities:
  individus:
    macros:
      ALIGN_DEPENDANCE_PREVALENCE: False
      MU: 1

    processes:
      options_initialisation:
        - dependance_initialisation()

      options_statistiques_initialisation:
        - dependance_statistiques_initialisation()

      dependance_statistiques_initialisation:
          - csv('dependance_by_period',
                fname = 'dependance.csv'
                )
          - csv('dependance_by_period',
                fname = 'dependance2.csv'
                )
          - csv('dependance_gir_by_period',
                fname = 'dependance_gir.csv'
                )
          - csv('incidence_by_period',
                fname = 'incidence.csv'
                )

      options_statistiques_fin_de_periode:
        - dependance_statistiques_fin_de_periode()

      dependance_statistiques_fin_de_periode:
        - csv('period', period, 'dependance', groupby(
            age, sexe, expr = count((dependance_niveau == 1) or (dependance_niveau == 2))
            ),
            fname = 'dependance.csv',
            mode = 'a'
            )
        - csv('period', period, 'dependance', groupby(
            age, data_origin, expr = count((dependance_niveau == 1) or (dependance_niveau == 2))
            ),
            fname = 'dependance2.csv',
            mode = 'a'
            )
        - csv(
            groupby(period, age, sexe, dependance_gir, count()),
            fname = 'dependance_gir.csv',
            mode = 'a'
            )
        - csv(
            groupby(
              period,
              age,
              sexe,
              ((dependance_niveau == 1) or (dependance_niveau == 2)) and (dependance_anciennete == 0),
              filter = (age >= 60)
              ),
            fname = 'dependance_incidence.csv',
            mode = 'a'
            )


simulation:
  periods: 11
  random_seed: 54321
